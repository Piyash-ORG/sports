<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Sports Stream</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>

    <header>
        <h1>CRICfy TV</h1>
    </header>

    <main>
        <div class="player-container">
            <video id="videoPlayer" controls autoplay></video>
        </div>

        <div class="stream-list">
            <h2>üî¥ Live Now</h2>
            <div id="live-matches">
                </div>
            
            <h2>‚≠ê Recommended</h2>
            <div id="recommended-matches">
                </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const video = document.getElementById('videoPlayer');
            const liveMatchesContainer = document.getElementById('live-matches');
            const recommendedMatchesContainer = document.getElementById('recommended-matches');
            let hls;

            // JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
            async function loadStreams() {
                try {
                    const response = await fetch('streams.json');
                    const data = await response.json();
                    
                    // ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                    const liveNow = data.liveNow;
                    liveMatchesContainer.innerHTML = ''; // ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ
                    liveNow.forEach(match => {
                        const matchCard = createMatchCard(match);
                        liveMatchesContainer.appendChild(matchCard);
                    });

                    // ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨‡¶ø‡¶§ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                    const recommended = data.recommended;
                    recommendedMatchesContainer.innerHTML = '';
                    recommended.forEach(match => {
                        const matchCard = createMatchCard(match);
                        recommendedMatchesContainer.appendChild(matchCard);
                    });

                    // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶≤‡ßá ‡¶ï‡¶∞‡¶æ
                    if (liveNow.length > 0 && liveNow[0].streams.length > 0) {
                        playStream(liveNow[0].streams[0].url);
                    }

                } catch (error) {
                    console.error('Error loading stream data:', error);
                    liveMatchesContainer.innerHTML = '<p>Could not load matches.</p>';
                }
            }
            
            // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
            function createMatchCard(match) {
                const card = document.createElement('div');
                card.className = 'match-card';
                
                let streamLinksHTML = match.streams.map(stream => 
                    `<button class="stream-link" data-url="${stream.url}">${stream.name}</button>`
                ).join('');

                card.innerHTML = `
                    <div class="match-info">
                        <img src="${match.team1.logo}" alt="${match.team1.name}">
                        <span>${match.team1.name} vs ${match.team2.name}</span>
                        <img src="${match.team2.logo}" alt="${match.team2.name}">
                    </div>
                    <div class="match-links">
                        ${streamLinksHTML}
                    </div>
                `;
                return card;
            }

            // m3u8 ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡ßç‡¶≤‡ßá ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
            function playStream(streamUrl) {
                if (Hls.isSupported()) {
                    if (hls) {
                        hls.destroy();
                    }
                    hls = new Hls();
                    hls.loadSource(streamUrl);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function () {
                        video.play();
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = streamUrl;
                    video.addEventListener('loadedmetadata', function () {
                        video.play();
                    });
                }
            }

            // ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßá‡¶á ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Æ‡¶ü‡¶ø ‡¶™‡ßç‡¶≤‡ßá ‡¶π‡¶¨‡ßá
            document.body.addEventListener('click', function(event) {
                if (event.target.classList.contains('stream-link')) {
                    const url = event.target.getAttribute('data-url');
                    playStream(url);
                }
            });

            // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            loadStreams();
        });
    </script>
</body>
</html>
